/*! taobaofocus 2014-06-04 */

!function(a,b){function c(a){this.tr=a,this.init()}a.recalculateTotal=function(){var c=0;b(a.carts).each(function(){c+=100*this.getTotalPrice()});var d=.1*c,e=c+d;c/=100,d/=100,e/=100,a.itemHolder.text(c.toFixed(2)),a.commissionHolder.text(d.toFixed(2)),a.priceHolder.text(e.toFixed(2))},c.prototype.init=function(){function c(){b.ajax({url:"/customer/adjust-cart",dataType:"json",type:"POST",data:{skuid:d.skuid,quantity:d.getQuantity(),_csrf:b("input[name='_csrf']").val()},success:function(b,c){"success"===c&&"success"===b.result&&a.recalculateTotal()},beforeSend:function(){},error:function(){},complete:function(){d.popover.popover("hide")}})}var d=this,e=this.tr,f=e.find('input[name="skuid"]');this.skuid=parseInt(f.val()),f.remove(),this.price=parseFloat(e.find("span.price").text());var g,h=b(e.find('button[name="quantity-minus"]')),i=b(e.find('button[name="quantity-plus"]')),j=b(e.find("input[name='quantity']"));j.bind("propertychange change keyup input paste",function(){clearTimeout(g),d.popover.popover("show");var a=j.val(),b=j.data("last");parseInt(a)?a!==b&&j.data("last",a):j.val(1),1==j.val()?h.addClass("disabled"):h.removeClass("disabled"),g=setTimeout(c,1e3)}),i.click(function(){var a=d.getQuantity();a+=1,j.val(a),h.removeClass("disabled"),j.trigger("change")}),h.click(function(){var a=d.getQuantity();a=a-1||1,j.val(a),j.trigger("change")}),this.minusBtn=h,this.plusBtn=i,this.quanInput=j;var k=b(e.find('a[name="item-del"]')),l=b("#modal-confirm");k.click(function(){l.data("skuid",k.data("skuid")),b("#confirmModal").modal("show")}),this.popover=b(e.find('div[name="quantity-container"]')),this.popover.popover({placement:"top",trigger:"manual",html:"true",container:"body",content:"<p><img src='/images/loading.gif' width='43px' height='30px'></p><p>Processing, please wait</p>"})},c.prototype.getTotalPrice=function(){var a=this.getQuantity(),b=a*this.price;return parseFloat(b.toFixed(2))},c.prototype.getQuantity=function(){return parseInt(this.quanInput.val())};var d=function(){a.carts=[],b("tr").each(function(){var d=b(this),e=new c(d);a.carts.push(e)});var d=b("#price-total"),e=b("#customer-commission"),f=b("#item-total");a.commissionHolder=e,a.priceHolder=d,a.itemHolder=f,a.recalculateTotal(),b("#modal-confirm").click(function(){var c=b(this),d=c.data("skuid");b("#confirmModal").modal("hide"),b.ajax({url:"/customer/remove-cart-item",dataType:"json",type:"POST",data:{skuid:d,_csrf:b("input[name='_csrf']").val()},success:function(b,c){if("success"===c&&"success"===b.result)try{for(var e=-1,f=0,g=a.carts.length;g>f;f++)if(a.carts[f].skuid==d){e=f;break}~e&&(a.carts[e].tr.remove(),a.carts.splice(e,1),a.recalculateTotal())}catch(h){}},beforeSend:function(){},error:function(){},complete:function(){}})})},e=function(){var a=function(){return{_csrf:b("#_csrf").val(),tag:b('input[name="addressRadio"]:checked').val()}},c=b("#btn-order-submit");c.click(function(){var c=b('input[name="addressRadio"]:checked');alert(c.val()),b.post("/customer/order/new",a()).done(function(a){console.log(a),"success"===a.result&&(window.location=a.nextUrl)}).fail(function(a){alert(a)}).always(function(){})})},f=function(){var a=b("#new-address-anchor"),c=b("#btn-submit-address"),d=b("div.address-container"),e=b("div.new-address-wrapper > div.new-address-editor"),f=b("#btn-cancel-address");a.click(function(){e.removeClass("hidden"),e.slideDown()}),c.click(function(){var a=function(){return{tag:b("input#inputTag").val(),country:b("select#countrySelect").val(),zipCode:b("input#inputZipCode").val(),addressee:b("input#inputAddressee").val(),addresseeContact:b("input#inputContact").val(),address:b("input#inputAddress").val(),_csrf:b("#_csrf").val()}},c=a();b.post("/customer/address/new",c).done(function(a){"success"===a.result&&(b('input[name="addressRadio"]').each(function(){var a=b(this);a.attr("checked",!1)}),b('<div class="radio address-wrapper"><label><input type="radio" name="addressRadio" id="'+c.tag+'" value="'+c.tag+'" checked="true">'+c.tag+'</label><span class="info-details">'+c.address+","+c.addressee+" "+c.addresseeContact+"</span></div>").prependTo(d),e.slideUp())}).fail(function(){alert("fail")}).always(function(){})}),f.click(function(){e.slideUp()})};return b(document).ready(function(){d(),e(),f()}),window.focusTaobao=a,a}(window.focusTaobao||{},window.jQuery),!function(a,b){function c(a){this.tr=a,this.init()}a.recalculateTotal=function(){var c=0;b(a.carts).each(function(){c+=100*this.getTotalPrice()});var d=.1*c,e=c+d;c/=100,d/=100,e/=100,a.itemHolder.text(c.toFixed(2)),a.commissionHolder.text(d.toFixed(2)),a.priceHolder.text(e.toFixed(2))},c.prototype.init=function(){function c(){b.ajax({url:"/customer/adjust-cart",dataType:"json",type:"POST",data:{skuid:d.skuid,quantity:d.getQuantity(),_csrf:b("input[name='_csrf']").val()},success:function(b,c){"success"===c&&"success"===b.result&&a.recalculateTotal()},beforeSend:function(){},error:function(){},complete:function(){d.popover.popover("hide")}})}var d=this,e=this.tr,f=e.find('input[name="skuid"]');this.skuid=parseInt(f.val()),f.remove(),this.price=parseFloat(e.find("span.price").text());var g,h=b(e.find('button[name="quantity-minus"]')),i=b(e.find('button[name="quantity-plus"]')),j=b(e.find("input[name='quantity']"));j.bind("propertychange change keyup input paste",function(){clearTimeout(g),d.popover.popover("show");var a=j.val(),b=j.data("last");parseInt(a)?a!==b&&j.data("last",a):j.val(1),1==j.val()?h.addClass("disabled"):h.removeClass("disabled"),g=setTimeout(c,1e3)}),i.click(function(){var a=d.getQuantity();a+=1,j.val(a),h.removeClass("disabled"),j.trigger("change")}),h.click(function(){var a=d.getQuantity();a=a-1||1,j.val(a),j.trigger("change")}),this.minusBtn=h,this.plusBtn=i,this.quanInput=j;var k=b(e.find('a[name="item-del"]')),l=b("#modal-confirm");k.click(function(){l.data("skuid",k.data("skuid")),b("#confirmModal").modal("show")}),this.popover=b(e.find('div[name="quantity-container"]')),this.popover.popover({placement:"top",trigger:"manual",html:"true",container:"body",content:"<p><img src='/images/loading.gif' width='43px' height='30px'></p><p>Processing, please wait</p>"})},c.prototype.getTotalPrice=function(){var a=this.getQuantity(),b=a*this.price;return parseFloat(b.toFixed(2))},c.prototype.getQuantity=function(){return parseInt(this.quanInput.val())};var d=function(){a.carts=[],b("tr").each(function(){var d=b(this),e=new c(d);a.carts.push(e)});var d=b("#price-total"),e=b("#customer-commission"),f=b("#item-total");a.commissionHolder=e,a.priceHolder=d,a.itemHolder=f,a.recalculateTotal(),b("#modal-confirm").click(function(){var c=b(this),d=c.data("skuid");b("#confirmModal").modal("hide"),b.ajax({url:"/customer/remove-cart-item",dataType:"json",type:"POST",data:{skuid:d,_csrf:b("input[name='_csrf']").val()},success:function(b,c){if("success"===c&&"success"===b.result)try{for(var e=-1,f=0,g=a.carts.length;g>f;f++)if(a.carts[f].skuid==d){e=f;break}~e&&(a.carts[e].tr.remove(),a.carts.splice(e,1),a.recalculateTotal())}catch(h){}},beforeSend:function(){},error:function(){},complete:function(){}})})},e=function(){var a=function(){return{_csrf:b("#_csrf").val(),tag:b('input[name="addressRadio"]:checked').val()}},c=b("#btn-order-submit");c.click(function(){var c=b('input[name="addressRadio"]:checked');alert(c.val()),b.post("/customer/order/new",a()).done(function(a){console.log(a),"success"===a.result&&(window.location=a.nextUrl)}).fail(function(a){alert(a)}).always(function(){})})},f=function(){var a=b("#new-address-anchor"),c=b("#btn-submit-address"),d=b("div.address-container"),e=b("div.new-address-wrapper > div.new-address-editor"),f=b("#btn-cancel-address");a.click(function(){e.removeClass("hidden"),e.slideDown()}),c.click(function(){var a=function(){return{tag:b("input#inputTag").val(),country:b("select#countrySelect").val(),zipCode:b("input#inputZipCode").val(),addressee:b("input#inputAddressee").val(),addresseeContact:b("input#inputContact").val(),address:b("input#inputAddress").val(),_csrf:b("#_csrf").val()}},c=a();b.post("/customer/address/new",c).done(function(a){"success"===a.result&&(b('input[name="addressRadio"]').each(function(){var a=b(this);a.attr("checked",!1)}),b('<div class="radio address-wrapper"><label><input type="radio" name="addressRadio" id="'+c.tag+'" value="'+c.tag+'" checked="true">'+c.tag+'</label><span class="info-details">'+c.address+","+c.addressee+" "+c.addresseeContact+"</span></div>").prependTo(d),e.slideUp())}).fail(function(){alert("fail")}).always(function(){})}),f.click(function(){e.slideUp()})};return b(document).ready(function(){d(),e(),f()}),window.focusTaobao=a,a}(window.focusTaobao||{},window.jQuery);
//# sourceMappingURL=checkout.min.map